import{d as x,r as v,w as fe,c,a as e,F as O,x as F,h as y,f as S,o as r,b as I,y as be,t as h,q as M,z as B,A as V,B as he,C as ge,D as Ce,E as w,i as b,m as $,G as L,l as ke,j as qe,T as ye,p as Ee,n as U}from"./index-ca90286d.js";import{H as Pe}from"./Header-d700b98c.js";import{_ as T}from"./_plugin-vue_export-helper-c27b6911.js";import{V as we}from"./VisualizarItensPopup-8055c543.js";import{N as Se}from"./NotificationPopUp-aebb2319.js";import{A as $e}from"./AcaoConcluidaPopup-497e7117.js";import{r as Ae,a as Ne}from"./UserCircleIcon-fd25655d.js";import{r as Re}from"./ArrowUpCircleIcon-48335c86.js";import{r as Ve}from"./TrashIcon-02dfbd81.js";import"./logosvg-29db6bb5.js";const Ue={class:"popup-content"},Ie={key:0,class:"loading-state"},xe={key:1,class:"options-container"},Te=["id","value"],ze=["for"],De=x({__name:"PopUp",props:{visible:{type:Boolean},tiposEnvio:{},selecaoAtual:{}},emits:["close","submit"],setup(A,{emit:_}){const t=A,f=_,u=v(null);fe(()=>t.visible,l=>{l&&(u.value=t.selecaoAtual)});function g(){f("close")}function d(){u.value&&f("submit",u.value)}return(l,k)=>l.visible?(r(),c("div",{key:0,class:"popup-overlay",onClick:y(g,["self"])},[e("div",Ue,[k[1]||(k[1]=e("h3",{class:"title"},"Selecionar Tipo de Envio",-1)),!l.tiposEnvio||l.tiposEnvio.length===0?(r(),c("div",Ie," Carregando opções de envio... ")):(r(),c("div",xe,[(r(!0),c(O,null,F(l.tiposEnvio,C=>(r(),c("div",{key:C.id_tipo_envio_requisicao,class:"radio-item"},[I(e("input",{type:"radio",id:"envio-"+C.id_tipo_envio_requisicao,value:C.id_tipo_envio_requisicao,"onUpdate:modelValue":k[0]||(k[0]=n=>u.value=n)},null,8,Te),[[be,u.value]]),e("label",{for:"envio-"+C.id_tipo_envio_requisicao},h(C.descricao_tipo_envio_requisicao),9,ze)]))),128))])),e("div",{class:"actions"},[e("button",{onClick:g,class:"button-secondary"},"Cancelar"),e("button",{onClick:d,class:"button-confirm"},"Confirmar")])])])):S("",!0)}});const Me=T(De,[["__scopeId","data-v-b7b6461b"]]),Be={class:"popup-content"},Le={class:"message"},Oe=x({__name:"ConfirmarCancelamentoPopup",props:{visible:{type:Boolean},requisicao:{}},emits:["close","confirm"],setup(A,{emit:_}){const t=_;function f(){t("close")}function u(){t("confirm")}return(g,d)=>{var l;return g.visible?(r(),c("div",{key:0,class:"popup-overlay",onClick:y(f,["self"])},[e("div",Be,[d[2]||(d[2]=e("h3",{class:"title"},"Confirmar Cancelamento",-1)),e("p",Le,[d[0]||(d[0]=M("Você tem certeza que deseja cancelar a requisição ")),e("strong",null,h((l=g.requisicao)==null?void 0:l.numero_requisicao),1),d[1]||(d[1]=M("?"))]),e("div",{class:"actions"},[e("button",{onClick:f,class:"button-secondary"},"Não"),e("button",{onClick:u,class:"button-danger"},"Sim, Cancelar")])])])):S("",!0)}}});const Fe=T(Oe,[["__scopeId","data-v-48a54e6b"]]),Ge={class:"container"},He={class:"grow"},je={class:"page-container"},Je={class:"header-container"},Ke={class:"header-left"},Qe={class:"user-info-wrapper"},We={class:"user-name"},Xe={key:0,class:"dropdown-menu"},Ye={class:"table-scroll-container"},Ze={key:0,class:"loading-message"},eo={key:1,class:"responsive-table"},oo={key:"no-data"},io=["onClick"],ao={"data-label":"Selecionar"},so=["onUpdate:modelValue"],to={"data-label":"Data/Hora"},no={"data-label":"UR"},ro={"data-label":"Número"},lo={"data-label":"Situação"},co={"data-label":"Prioridade"},uo={class:"envio-cell"},po=["data-tooltip"],vo={"data-label":"Envio"},_o={"data-label":"envio-cell"},mo={class:"tooltip-container","data-tooltip":"Alterar Tipo de Envio"},fo=["onClick"],bo={"data-label":"Ações"},ho={class:"acoes-cell"},go={class:"tooltip-container","data-tooltip":"Visualizar Itens"},Co={class:"tooltip-container","data-tooltip":"Cancelar Requisição"},ko={"data-label":"Observação"},qo={class:"footer-actions"},yo=["disabled"],Eo=x({__name:"RequisicoesView",setup(A){const _=Ee(),t=v([]),f=v(!0),u=v(!1),g=v("Usuário"),d=v(!1);v(null);const l=v(!1),k=v(!1),C=v(!1),n=v(null),P=v([]),m=B({visible:!1,title:"",message:"",onCloseCallback:null});function q(i,o,s=null){m.title=i,m.message=o,m.onCloseCallback=s,m.visible=!0}function G(){m.visible=!1,m.onCloseCallback&&m.onCloseCallback(),m.onCloseCallback=null}const E=B({visible:!1,title:"",message:""}),H=V(()=>[...t.value].sort((i,o)=>i.prioridade_requisicao&&!o.prioridade_requisicao?-1:!i.prioridade_requisicao&&o.prioridade_requisicao?1:0)),j=V(()=>t.value.some(i=>i.checked));he(async()=>{const i=localStorage.getItem("user-token");if(i)try{const o=JSON.parse(atob(i.split(".")[1]));g.value=o.nome||"Usuário"}catch{g.value="Usuário"}await J(),await oe()});async function J(){try{P.value=await ge()}catch(i){console.error("Erro ao carregar tipos de envio:",i)}}const z=V({get:()=>t.value.length>0&&t.value.every(i=>i.checked),set:i=>{t.value.forEach(o=>{o.checked=i})}});function K(i){const o=i.target;t.value.forEach(s=>{s.checked=o.checked})}function Q(i){i.checked=!i.checked}async function W(){const i=t.value.filter(s=>s.checked);if(i.length===0){q("Atenção","Por favor, selecione pelo menos uma requisição para iniciar a separação.");return}if(!i.every(s=>!!s.tipo_envio)){q("Atenção","Por favor, defina o tipo de envio para todas as requisições selecionadas antes de continuar.");return}u.value=!0;try{const s=i.map(a=>w(a.id_requisicao,{status:"enviado-para-separacao"}));await Promise.all(s),E.title="Sucesso!",E.message=`${i.length} requisição(ões) enviada(s) para separação.`,E.visible=!0}catch(s){console.error("Erro ao iniciar separação em massa:",s),q("Erro","Ocorreu um erro ao enviar as requisições para separação.")}finally{u.value=!1}}async function X(i){const o=t.value.findIndex(s=>s.id_requisicao===i.id_requisicao);if(o!==-1){const s=!t.value[o].prioridade_requisicao;try{await w(i.id_requisicao,{prioridade_requisicao:s}),t.value[o].prioridade_requisicao=s}catch(a){console.error("Erro ao atualizar prioridade:",a),q("Erro","Não foi possível alterar a prioridade.")}}}function Y(i){n.value=i,l.value=!0}function N(){l.value=!1}function Z(i){return i.tipo_envio?i.tipo_envio.descricao_tipo_envio_requisicao:"Normal (PAC)"}async function ee(i){if(!n.value){N();return}try{const o=await w(n.value.id_requisicao,{id_tipo_envio_requisicao:i}),s=t.value.findIndex(a=>a.id_requisicao===n.value.id_requisicao);s!==-1&&(t.value[s].tipo_envio=o.tipo_envio)}catch(o){console.error("Erro ao atualizar tipo de envio:",o),q("Erro","Falha ao guardar o tipo de envio.")}finally{N()}}async function oe(){f.value=!0;try{const i=await Ce("pendente"),o=await ie(),s=[];t.value=await Promise.all(i.map(async a=>{const p={...a,checked:!1,tipo_envio:a.tipo_envio||null};return p.tipo_envio||(p.tipo_envio=P.value.find(R=>R.id_tipo_envio_requisicao===o)||{id_tipo_envio_requisicao:o,descricao_tipo_envio_requisicao:"Normal (PAC)"},s.push(w(p.id_requisicao,{id_tipo_envio_requisicao:o}).catch(R=>{console.error(`Falha ao persistir tipo de envio para req ${p.id_requisicao}:`,R)}))),p})),s.length>0&&await Promise.allSettled(s)}catch(i){q("erro","Erro ao buscar dados: "+i.message)}finally{f.value=!1}}async function ie(){var o;const i=P.value.find(s=>s.descricao_tipo_envio_requisicao==="Normal (PAC)");return i?i.id_tipo_envio_requisicao:((o=P.value[0])==null?void 0:o.id_tipo_envio_requisicao)||1}function ae(i){n.value=i,k.value=!0}function se(){k.value=!1}function te(i){n.value=i,C.value=!0}function D(){C.value=!1}async function ne(){if(n.value)try{await w(n.value.id_requisicao,{status:"cancelada"}),t.value=t.value.filter(i=>{var o;return i.id_requisicao!==((o=n.value)==null?void 0:o.id_requisicao)}),q("Sucesso",`Requisição ${n.value.numero_requisicao} cancelada com sucesso.`)}catch(i){q("Erro",`Erro ao cancelar requisição: ${i.message}`)}finally{D()}}function re(){d.value=!d.value}function le(){localStorage.removeItem("user-token"),_.push({name:"Login"})}function ce(){_.push({name:"GerenciamentoUsuarios"})}function ue(){_.push({name:"Monitoramento"})}function de(){_.push({name:"Separacao"})}function pe(){_.push({name:"Conferencia"})}function ve(){_.push({name:"Embalagem"})}function _e(){_.push({name:"Remessa"})}function me(i){if(!i)return"";const o=i.toLowerCase().replace(/\s+/g,"-");return o==="pendente"||o==="recebida"?"status-recebida":`status-${o}`}return(i,o)=>{var s;return r(),c("div",Ge,[b(Pe),e("main",He,[e("div",je,[e("div",Je,[e("div",Ke,[e("div",Qe,[e("div",{class:"user-info",onClick:re},[b($(Ae),{class:"user-icon"}),e("span",We,h(g.value),1)]),d.value?(r(),c("div",Xe,[e("button",{onClick:ce,class:"gouser-item"},"Gerenciar Usuários"),e("button",{onClick:ue,class:"gouser-item"},"Monitoramento"),e("button",{onClick:de,class:"gouser-item"},"Separação"),e("button",{onClick:pe,class:"gouser-item"},"Conferência"),e("button",{onClick:ve,class:"gouser-item"},"Embalagem"),e("button",{onClick:_e,class:"gouser-item"},"Conferência/Remessa"),e("button",{onClick:le,class:"dropdown-item"},"Sair")])):S("",!0)]),o[2]||(o[2]=e("h2",{class:"container-title"},"Requisições - Atendimento",-1))])]),e("div",Ye,[f.value?(r(),c("div",Ze,"Carregando requisições...")):(r(),c("table",eo,[e("thead",null,[e("tr",null,[e("th",null,[I(e("input",{type:"checkbox","onUpdate:modelValue":o[0]||(o[0]=a=>z.value=a),onChange:K},null,544),[[L,z.value]])]),o[3]||(o[3]=e("th",null,"Data/Hora",-1)),o[4]||(o[4]=e("th",null,"UR",-1)),o[5]||(o[5]=e("th",null,"Número",-1)),o[6]||(o[6]=e("th",null,"Situação",-1)),o[7]||(o[7]=e("th",null,"Prioridade",-1)),o[8]||(o[8]=e("th",null,"Envio",-1)),o[9]||(o[9]=e("th",null,"Ações",-1)),o[10]||(o[10]=e("th",null,"Observação",-1))])]),f.value?S("",!0):(r(),ke(ye,{key:0,tag:"tbody",name:"list"},{default:qe(()=>[t.value.length===0?(r(),c("tr",oo,o[11]||(o[11]=[e("td",{colspan:"8",class:"no-data-message"},"Nenhuma requisição encontrada.",-1)]))):S("",!0),(r(!0),c(O,null,F(H.value,a=>(r(),c("tr",{key:a.id_requisicao,class:U(["list-item",{"row-checked":a.checked}]),onClick:p=>Q(a)},[e("td",ao,[I(e("input",{type:"checkbox","onUpdate:modelValue":p=>a.checked=p,onClick:o[1]||(o[1]=y(()=>{},["stop"]))},null,8,so),[[L,a.checked]])]),e("td",to,h(new Date(a.data_requisicao).toLocaleString("pt-BR")),1),e("td",no,h(a.requisitante_requisicao),1),e("td",ro,h(a.numero_requisicao),1),e("td",lo,[e("span",{class:U(["status-badge",me(a.situacao.descricao_situacao_requisicao)])},h(a.situacao.descricao_situacao_requisicao),3)]),e("td",co,[e("div",uo,[e("div",{class:"tooltip-container","data-tooltip":a.prioridade_requisicao?"Desmarcar Prioridade":"Marcar como Prioritário"},[b($(Re),{onClick:y(p=>X(a),["stop"]),class:U(["icon-acao-prioridade",{"icon-prioridade-ativa":a.prioridade_requisicao}])},null,8,["onClick","class"])],8,po)])]),e("td",vo,[e("div",_o,[e("div",mo,[e("button",{onClick:y(p=>Y(a),["stop"]),class:"button-envio-link"},h(Z(a)),9,fo)])])]),e("td",bo,[e("div",ho,[e("div",go,[b($(Ne),{onClick:y(p=>ae(a),["stop"]),class:"icon-acao"},null,8,["onClick"])]),e("div",Co,[b($(Ve),{onClick:y(p=>te(a),["stop"]),class:"icon-acao icon-cancelar"},null,8,["onClick"])])])]),e("td",ko,h(a.observacao_requisicao||"-"),1)],10,io))),128))]),_:1}))]))]),e("footer",qo,[e("button",{onClick:W,class:"button-primary",disabled:!j.value||u.value},h(u.value?"Aguarde...":"Enviar para Separação"),9,yo)])])]),b(Me,{visible:l.value,"tipos-envio":P.value,"selecao-atual":((s=n.value)==null?void 0:s.id_tipo_envio_requisicao)??null,onClose:N,onSubmit:ee},null,8,["visible","tipos-envio","selecao-atual"]),b(we,{visible:k.value,requisicao:n.value,onClose:se},null,8,["visible","requisicao"]),b(Fe,{visible:C.value,requisicao:n.value,onClose:D,onConfirm:ne},null,8,["visible","requisicao"]),b(Se,{visible:m.visible,title:m.title,message:m.message,onClose:G},null,8,["visible","title","message"]),b($e,{visible:E.visible,title:E.title,message:E.message},null,8,["visible","title","message"])])}}});const xo=T(Eo,[["__scopeId","data-v-fd8d7075"]]);export{xo as default};
