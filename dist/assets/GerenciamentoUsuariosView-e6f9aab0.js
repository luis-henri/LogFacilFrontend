import{d as R,r as m,z as Q,B as W,H as X,I as Y,A as Z,w as S,c as n,i as w,a,b as i,v as u,J as F,F as E,x as h,n as N,t as f,h as P,f as V,K as ee,j as ae,L as oe,o as d,M as le,N as se}from"./index-ca90286d.js";import{N as te}from"./NotificationPopUp-aebb2319.js";import{i as $}from"./validators-53c84f5e.js";import{H as ie}from"./Header-d700b98c.js";import{_ as re}from"./_plugin-vue_export-helper-c27b6911.js";const ne={class:"user-management-container"},ue={key:0,class:"card edit-form-card"},de={class:"form-grid"},pe={class:"form-group"},me={class:"form-group"},fe={class:"form-group"},ce={class:"form-group"},ve={class:"form-group"},be=["value"],ge={class:"form-group"},_e={class:"status-switch"},ye={class:"card filter-card"},Ue={class:"filter-grid"},Ce={class:"form-group"},we={class:"form-group"},Ee={class:"form-group"},he={class:"card user-list-card"},Ne={class:"table-container"},Ve={class:"user-table"},xe={key:0},ke={key:1},Ae={"data-label":"Nome"},Ie={"data-label":"Email"},Se={"data-label":"CPF"},Fe={"data-label":"Data Cadastro"},Pe={"data-label":"Status"},$e={"data-label":"Ações",class:"actions-cell"},De=["onClick"],Me={key:0,class:"modal-overlay"},qe={class:"modal-content"},Le={class:"form-group"},ze={class:"form-group"},Be={class:"form-group"},Ge={class:"form-group"},He={class:"form-group"},Oe=["value"],Te=R({__name:"GerenciamentoUsuariosView",setup(je){const b=m("consultar"),_=m(!1),v=m([]),y=m(!0),U=m([]),p=m({nome:"",email:"",cpf:""}),t=m({nome:"",email:"",cpf:"",senha:"",perfilId:""}),s=m(null),c=Q({visible:!1,title:"",message:""});function r(l,e){c.title=l,c.message=e,c.visible=!0}function D(){c.visible=!1}W(async()=>{await C(),await M()});async function M(){try{const l=await X();U.value=l}catch(l){console.error("Erro ao carregar perfis:",l),r("Erro","Não foi possível carregar a lista de perfis.")}}async function C(){y.value=!0;try{v.value=await Y()}catch(l){console.error("Erro ao carregar usuários:",l),r("Erro","Não foi possível carregar a lista de usuários.")}finally{y.value=!1}}const q=async()=>{if(!$(t.value.cpf)){r("Erro de Validação","O CPF inserido não é válido.");return}if(!t.value.senha){r("Erro","O campo senha é obrigatório.");return}if(!t.value.perfilId){r("Erro","A seleção de um perfil é obrigatória.");return}try{await le({nome:t.value.nome,email:t.value.email,cpf:t.value.cpf.replace(/[.\-]/g,""),password:t.value.senha,perfilId:t.value.perfilId}),r("Sucesso","Usuário adicionado com sucesso!"),x(),await C()}catch(l){r("Erro",`Erro ao adicionar usuário: ${l.message}`)}},L=l=>{s.value={...l,ativo:l.situacao.descricao_situacao_usuario==="Ativo",senha:"",perfilId:l.perfis&&l.perfis.length>0?l.perfis[0].perfil.id_perfil:void 0},b.value="editar",window.scrollTo({top:0,behavior:"smooth"})},z=async()=>{if(s.value){if(!$(s.value.cpf_usuario)){r("Erro de Validação","O CPF inserido não é válido.");return}if(!s.value.perfilId){r("Erro","A seleção de um perfil é obrigatória.");return}try{await se(s.value.id_usuario,{nome:s.value.nome_usuario,email:s.value.email_usuario,cpf:s.value.cpf_usuario.replace(/[.\-]/g,""),senha:s.value.senha,ativo:s.value.ativo,perfilId:s.value.perfilId}),r("Sucesso","Usuário atualizado com sucesso!"),k(),await C()}catch(l){r("Erro",`Erro ao atualizar usuário: ${l.message}`)}}},B=()=>{_.value=!0},x=()=>{_.value=!1,t.value={nome:"",email:"",cpf:"",senha:"",perfilId:""}},k=()=>{s.value=null,b.value="consultar"},A=Z(()=>{if(!v.value||v.value.length===0)return[];const l=p.value.nome.trim().toLowerCase(),e=p.value.email.trim().toLowerCase(),o=p.value.cpf.replace(/[.\-]/g,"");return!l&&!e&&!o?v.value:v.value.filter(g=>{const H=g.nome_usuario.toLowerCase(),O=g.email_usuario.toLowerCase(),T=g.cpf_usuario.replace(/[.\-]/g,""),j=H.includes(l),J=O.includes(e),K=T.includes(o);return j&&J&&K})}),G=l=>l?new Date(l).toLocaleDateString("pt-BR"):"",I=l=>{if(!l)return"";let e=l.replace(/\D/g,"");return e=e.slice(0,11),e.length>9?e=e.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4"):e.length>6?e=e.replace(/(\d{3})(\d{3})(\d{1,3})/,"$1.$2.$3"):e.length>3&&(e=e.replace(/(\d{3})(\d{1,3})/,"$1.$2")),e};return S(()=>t.value.cpf,l=>{t.value.cpf=I(l)}),S(()=>{var l;return(l=s.value)==null?void 0:l.cpf_usuario},l=>{s.value&&l&&(s.value.cpf_usuario=I(l))}),(l,e)=>(d(),n("div",ne,[w(ie),e[40]||(e[40]=a("h1",{class:"main-title"},"Gerenciamento de Usuários",-1)),b.value==="editar"&&s.value?(d(),n("div",ue,[e[23]||(e[23]=a("h2",{class:"card-title"},"Editar Usuário",-1)),a("form",{onSubmit:P(z,["prevent"])},[a("div",de,[a("div",pe,[e[14]||(e[14]=a("label",{for:"edit-nome",class:"form-label"},"Nome",-1)),i(a("input",{type:"text",id:"edit-nome","onUpdate:modelValue":e[0]||(e[0]=o=>s.value.nome_usuario=o),required:"",class:"form-input"},null,512),[[u,s.value.nome_usuario]])]),a("div",me,[e[15]||(e[15]=a("label",{for:"edit-email",class:"form-label"},"Email",-1)),i(a("input",{type:"email",id:"edit-email","onUpdate:modelValue":e[1]||(e[1]=o=>s.value.email_usuario=o),required:"",class:"form-input"},null,512),[[u,s.value.email_usuario]])]),a("div",fe,[e[16]||(e[16]=a("label",{for:"edit-cpf",class:"form-label"},"CPF",-1)),i(a("input",{type:"text",id:"edit-cpf","onUpdate:modelValue":e[2]||(e[2]=o=>s.value.cpf_usuario=o),required:"",maxlength:"14",class:"form-input",placeholder:"000.000.000-00"},null,512),[[u,s.value.cpf_usuario]])]),a("div",ce,[e[17]||(e[17]=a("label",{for:"edit-senha",class:"form-label"},"Nova Senha (opcional)",-1)),i(a("input",{type:"password",id:"edit-senha","onUpdate:modelValue":e[3]||(e[3]=o=>s.value.senha=o),class:"form-input",placeholder:"Deixe em branco para não alterar"},null,512),[[u,s.value.senha]])]),a("div",ve,[e[19]||(e[19]=a("label",{for:"edit-perfil",class:"form-label"},"Perfil",-1)),i(a("select",{id:"edit-perfil","onUpdate:modelValue":e[4]||(e[4]=o=>s.value.perfilId=o),required:"",class:"form-input"},[e[18]||(e[18]=a("option",{disabled:"",value:""},"Selecione um perfil",-1)),(d(!0),n(E,null,h(U.value,o=>(d(),n("option",{key:o.id_perfil,value:o.id_perfil},f(o.nome_perfil),9,be))),128))],512),[[F,s.value.perfilId]])])]),a("div",ge,[e[21]||(e[21]=a("label",{class:"form-label"},"Status",-1)),a("div",_e,[a("button",{onClick:e[5]||(e[5]=o=>s.value.ativo=!s.value.ativo),type:"button",class:N([{"is-active":s.value.ativo},"switch-toggle"])},e[20]||(e[20]=[a("span",{class:"switch-handle"},null,-1)]),2),a("span",{class:N(["switch-label",{"is-active":s.value.ativo}])},f(s.value.ativo?"Ativo":"Inativo"),3)])]),a("div",{class:"form-actions"},[a("button",{onClick:k,type:"button",class:"btn btn-secondary"},"Cancelar"),e[22]||(e[22]=a("button",{type:"submit",class:"btn btn-primary"},"Atualizar Usuário",-1))])],32)])):V("",!0),i(a("div",ye,[e[27]||(e[27]=a("h2",{class:"card-title"},"Consultar Usuários",-1)),a("div",Ue,[a("div",Ce,[e[24]||(e[24]=a("label",{for:"filtro-nome",class:"form-label"},"Nome",-1)),i(a("input",{type:"text",id:"filtro-nome","onUpdate:modelValue":e[6]||(e[6]=o=>p.value.nome=o),class:"form-input",placeholder:"Filtrar por nome..."},null,512),[[u,p.value.nome]])]),a("div",we,[e[25]||(e[25]=a("label",{for:"filtro-email",class:"form-label"},"Email",-1)),i(a("input",{type:"email",id:"filtro-email","onUpdate:modelValue":e[7]||(e[7]=o=>p.value.email=o),class:"form-input",placeholder:"Filtrar por e-mail..."},null,512),[[u,p.value.email]])]),a("div",Ee,[e[26]||(e[26]=a("label",{for:"filtro-cpf",class:"form-label"},"CPF",-1)),i(a("input",{type:"text",id:"filtro-cpf","onUpdate:modelValue":e[8]||(e[8]=o=>p.value.cpf=o),class:"form-input",placeholder:"Filtrar por CPF..."},null,512),[[u,p.value.cpf]])])]),a("div",{class:"add-user-action"},[a("button",{onClick:B,class:"btn btn-primary"}," Adicionar Novo Usuário ")])],512),[[ee,b.value==="consultar"]]),a("div",he,[e[31]||(e[31]=a("h2",{class:"card-title"},"Lista de Usuários",-1)),a("div",Ne,[a("table",Ve,[e[30]||(e[30]=a("thead",null,[a("tr",null,[a("th",null,"Nome"),a("th",null,"Email"),a("th",null,"CPF"),a("th",null,"Data Cadastro"),a("th",null,"Status"),a("th",{class:"text-center"},"Ações")])],-1)),a("tbody",null,[y.value?(d(),n("tr",xe,e[28]||(e[28]=[a("td",{colspan:"6",class:"table-message"},"Carregando usuários...",-1)]))):A.value.length===0?(d(),n("tr",ke,e[29]||(e[29]=[a("td",{colspan:"6",class:"table-message"},"Nenhum usuário encontrado.",-1)]))):V("",!0),(d(!0),n(E,null,h(A.value,o=>(d(),n("tr",{key:o.id_usuario,class:"user-row"},[a("td",Ae,f(o.nome_usuario),1),a("td",Ie,f(o.email_usuario),1),a("td",Se,f(o.cpf_usuario),1),a("td",Fe,f(G(o.data_cadastro_usuario)),1),a("td",Pe,[a("span",{class:N(["status-pill",o.situacao.descricao_situacao_usuario==="Ativo"?"status-pill--active":"status-pill--inactive"])},f(o.situacao.descricao_situacao_usuario),3)]),a("td",$e,[a("button",{onClick:g=>L(o),class:"btn-link"},"Editar",8,De)])]))),128))])])])]),w(oe,{name:"fade"},{default:ae(()=>[_.value?(d(),n("div",Me,[a("div",qe,[e[39]||(e[39]=a("h2",{class:"modal-title"},"Adicionar Novo Usuário",-1)),a("form",{onSubmit:P(q,["prevent"])},[a("div",Le,[e[32]||(e[32]=a("label",{for:"add-nome",class:"form-label"},"Nome",-1)),i(a("input",{type:"text",id:"add-nome","onUpdate:modelValue":e[9]||(e[9]=o=>t.value.nome=o),required:"",class:"form-input",placeholder:"Ex: Maria da Silva"},null,512),[[u,t.value.nome]])]),a("div",ze,[e[33]||(e[33]=a("label",{for:"add-email",class:"form-label"},"Email",-1)),i(a("input",{type:"email",id:"add-email","onUpdate:modelValue":e[10]||(e[10]=o=>t.value.email=o),required:"",class:"form-input",placeholder:"Ex: maria.silva@example.com"},null,512),[[u,t.value.email]])]),a("div",Be,[e[34]||(e[34]=a("label",{for:"add-cpf",class:"form-label"},"CPF",-1)),i(a("input",{type:"text",id:"add-cpf","onUpdate:modelValue":e[11]||(e[11]=o=>t.value.cpf=o),required:"",maxlength:"14",class:"form-input",placeholder:"000.000.000-00"},null,512),[[u,t.value.cpf]])]),a("div",Ge,[e[35]||(e[35]=a("label",{for:"add-senha",class:"form-label"},"Senha",-1)),i(a("input",{type:"password",id:"add-senha","onUpdate:modelValue":e[12]||(e[12]=o=>t.value.senha=o),required:"",class:"form-input",placeholder:"********"},null,512),[[u,t.value.senha]])]),a("div",He,[e[37]||(e[37]=a("label",{for:"add-perfil",class:"form-label"},"Perfil",-1)),i(a("select",{id:"add-perfil","onUpdate:modelValue":e[13]||(e[13]=o=>t.value.perfilId=o),required:"",class:"form-input"},[e[36]||(e[36]=a("option",{disabled:"",value:""},"Selecione um perfil",-1)),(d(!0),n(E,null,h(U.value,o=>(d(),n("option",{key:o.id_perfil,value:o.id_perfil},f(o.nome_perfil),9,Oe))),128))],512),[[F,t.value.perfilId]])]),a("div",{class:"form-actions"},[a("button",{onClick:x,type:"button",class:"btn btn-secondary"},"Cancelar"),e[38]||(e[38]=a("button",{type:"submit",class:"btn btn-primary"},"Salvar Usuário",-1))])],32)])])):V("",!0)]),_:1}),w(te,{visible:c.visible,title:c.title,message:c.message,onClose:D},null,8,["visible","title","message"])]))}});const Xe=re(Te,[["__scopeId","data-v-5ce964d0"]]);export{Xe as default};
