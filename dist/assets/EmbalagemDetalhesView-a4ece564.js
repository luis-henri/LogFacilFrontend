import{d as A,r as V,z as E,B as D,P as R,c as r,i as p,a as e,q as v,t as c,n as B,F as z,x as I,f as q,Q as L,p as S,E as k,o as n,b as _,v as f,m as T}from"./index-ca90286d.js";import{H as F}from"./Header-d700b98c.js";import{N as H}from"./NotificationPopUp-aebb2319.js";import{A as M}from"./AcaoConcluidaPopup-497e7117.js";import{r as $}from"./TrashIcon-02dfbd81.js";import{_ as O}from"./_plugin-vue_export-helper-c27b6911.js";import"./logosvg-29db6bb5.js";const Q={class:"container"},j={class:"grow p-4 sm:p-6 lg:p-8"},G={class:"page-container"},J={key:0,class:"content-wrapper"},K={class:"details-section"},W={key:0,class:"no-data-message"},X={key:1,class:"table-container"},Y={class:"responsive-table"},Z={"data-label":"Volume"},ee={"data-label":"Comprimento (cm)"},ae=["onUpdate:modelValue"],oe={"data-label":"Largura (cm)"},se=["onUpdate:modelValue"],te={"data-label":"Altura (cm)"},le=["onUpdate:modelValue"],ie={"data-label":"Peso (kg)"},re=["onUpdate:modelValue"],ne={"data-label":"Excluir",class:"actions-cell"},ue={key:1,class:"loading-message"},ce={class:"footer-actions"},de=["disabled"],me=A({__name:"EmbalagemDetalhesView",setup(pe){const C=L(),g=S(),o=V(null),b=V(!0),m=V(!1),i=E({visible:!1,title:"",message:""});function d(s,a){i.title=s,i.message=a,i.visible=!0}function N(){i.visible=!1}const u=E({visible:!1,title:"",message:""});D(async()=>{const s=C.params.id;try{o.value=await R(s),o.value&&!o.value.volumes&&(o.value.volumes=[])}catch(a){console.error("Erro ao buscar dados da requisição para embalagem:",a),d("Erro","Não foi possível carregar os dados da requisição.")}finally{b.value=!1}});function w(){o.value&&o.value.volumes.push({id_requisicao:o.value.id_requisicao,comprimento:null,largura:null,altura:null,peso:null})}function x(s){o.value&&o.value.volumes.splice(s,1)}async function P(){if(o.value){if(!o.value.volumes||o.value.volumes.length===0){d("Erro de Validação","É necessário adicionar pelo menos um volume para efetivar o pacote.");return}for(const[s,a]of o.value.volumes.entries())if(a.comprimento===null||a.largura===null||a.altura===null||a.peso===null||a.comprimento<=0||a.largura<=0||a.altura<=0||a.peso<=0){d("Erro de Validação",`Por favor, preencha todos os campos com valores válidos para o Volume ${s+1}.`);return}m.value=!0;try{const s={status:"enviado-para-conferencia-expedicao",volumes:o.value.volumes.map(a=>({comprimento:a.comprimento,largura:a.largura,altura:a.altura,peso:a.peso}))};await k(o.value.id_requisicao,s),u.title="Embalagem Efetivada!",u.message="A requisição foi enviada com sucesso para a próxima etapa de conferência.",u.visible=!0}catch(s){console.error("Erro ao efetivar pacote:",s),d("Erro","Não foi possível efetivar o pacote.")}finally{m.value=!1}}}async function U(){if(!o.value){g.push({name:"Embalagem"});return}try{await k(o.value.id_requisicao,{status:"enviado-para-embalagem"}),g.push({name:"Embalagem"})}catch(s){console.error("Erro ao voltar e reverter status:",s),d("Erro","Ocorreu um erro ao tentar voltar."),g.push({name:"Emabalagem"})}}return(s,a)=>{var y;return n(),r("div",Q,[p(F,{title:"Requisição - Embalagem"}),e("main",j,[e("div",G,[a[7]||(a[7]=e("div",{class:"header-container"},[e("h2",{class:"container-title"},"Requisicão - Embalagem")],-1)),!b.value&&o.value?(n(),r("div",J,[e("div",K,[e("div",null,[a[0]||(a[0]=e("strong",null,"Número:",-1)),v(" "+c(o.value.numero_requisicao),1)]),e("div",null,[a[1]||(a[1]=e("strong",null,"Unidade:",-1)),v(" "+c(o.value.requisitante_requisicao),1)]),e("div",null,[a[2]||(a[2]=e("strong",null,"Prioridade:",-1)),a[3]||(a[3]=v()),e("span",{class:B({"text-yellow-600 font-bold":o.value.prioridade_requisicao})},c(o.value.prioridade_requisicao?"Sim":"Não"),3)]),e("div",null,[a[4]||(a[4]=e("strong",null,"Tipo de Envio:",-1)),v(" "+c(((y=o.value.tipo_envio)==null?void 0:y.descricao_tipo_envio_requisicao)||"Não definido"),1)])]),e("div",{class:"volumes-section"},[a[5]||(a[5]=e("h3",{class:"items-title"},"Dimensões do Volume",-1)),e("button",{onClick:w,class:"button-add-volume"},"Adicionar Volume")]),!o.value.volumes||o.value.volumes.length===0?(n(),r("div",W," Nenhum volume registado para esta requisição. ")):(n(),r("div",X,[e("table",Y,[a[6]||(a[6]=e("thead",null,[e("tr",null,[e("th",null,"Volume"),e("th",null,"Comprimento (cm)"),e("th",null,"Largura (cm)"),e("th",null,"Altura (cm)"),e("th",null,"Peso (kg)"),e("th",null,"Excluir")])],-1)),e("tbody",null,[(n(!0),r(z,null,I(o.value.volumes,(t,h)=>(n(),r("tr",{key:h},[e("td",Z,c(h+1),1),e("td",ee,[_(e("input",{type:"number",min:"0",placeholder:"0","onUpdate:modelValue":l=>t.comprimento=l,class:"input-measure"},null,8,ae),[[f,t.comprimento,void 0,{number:!0}]])]),e("td",oe,[_(e("input",{type:"number",min:"0",placeholder:"0","onUpdate:modelValue":l=>t.largura=l,class:"input-measure"},null,8,se),[[f,t.largura,void 0,{number:!0}]])]),e("td",te,[_(e("input",{type:"number",min:"0",placeholder:"0","onUpdate:modelValue":l=>t.altura=l,class:"input-measure"},null,8,le),[[f,t.altura,void 0,{number:!0}]])]),e("td",ie,[_(e("input",{type:"number",min:"0",placeholder:"0","onUpdate:modelValue":l=>t.peso=l,class:"input-measure"},null,8,re),[[f,t.peso,void 0,{number:!0}]])]),e("td",ne,[p(T($),{onClick:l=>x(h),class:"icon-acao icon-cancelar"},null,8,["onClick"])])]))),128))])])]))])):q("",!0),b.value?(n(),r("div",ue,"Carregando detalhes da embalagem...")):q("",!0),e("footer",ce,[e("button",{onClick:U,class:"button-secondary"},"Voltar"),e("button",{onClick:P,class:"button-primary",disabled:m.value},c(m.value?"Aguarde...":"Efetivar Pacote"),9,de)])])]),p(H,{visible:i.visible,title:i.title,message:i.message,onClose:N},null,8,["visible","title","message"]),p(M,{visible:u.visible,title:u.title,message:u.message},null,8,["visible","title","message"])])}}});const ye=O(me,[["__scopeId","data-v-10936908"]]);export{ye as default};
