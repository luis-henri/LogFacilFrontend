import{d as x,r as f,z as g,B as C,P as k,c as u,i as q,a as e,q as v,t as r,n as P,F as A,x as I,f as h,Q,p as R,E as y,o as c,b as B,v as D}from"./index-ca90286d.js";import{H as $}from"./Header-d700b98c.js";import{N as z}from"./NotificationPopUp-aebb2319.js";import{A as M}from"./AcaoConcluidaPopup-497e7117.js";import{_ as U}from"./_plugin-vue_export-helper-c27b6911.js";import"./logosvg-29db6bb5.js";const O={class:"container"},T={class:"grow p-4 sm:p-6 lg:p-8"},j={class:"page-container"},F={key:0,class:"content-wrapper"},H={class:"details-section"},L={class:"table-container responsive-table"},G={"data-label":"Endereço"},J={"data-label":"Material"},K={"data-label":"Qtd. Solicitada"},W={"data-label":"Qtd. Atendida"},X=["onUpdate:modelValue","max","onInput"],Y={key:1,class:"loading-message"},Z={class:"footer-actions"},aa=["disabled"],ea=x({__name:"SeparaçãoDetalhesView",setup(ia){const S=Q(),p=R(),t=f(null),m=f(!0),_=f(!1),n=g({visible:!1,title:"",message:""});function d(i,a){n.title=i,n.message=a,n.visible=!0}function E(){n.visible=!1}const l=g({visible:!1,title:"",message:""});C(async()=>{const i=S.params.id;try{t.value=await k(i),t.value&&t.value.itens.forEach(a=>{a.quantidade_atendida_item_requisicao=null})}catch(a){console.error("Erro",a),d("Erro","Não foi possível carregar os dados da requisição.")}finally{m.value=!1}});function N(i){const a=i.quantidade_atendida_item_requisicao,o=i.quantidade_solicitada_item_requisicao;a!==null&&a<0&&(i.quantidade_atendida_item_requisicao=0),a!==null&&a>o&&(i.quantidade_atendida_item_requisicao=o)}async function V(){if(t.value){for(const i of t.value.itens){const a=i.quantidade_atendida_item_requisicao||0,o=i.quantidade_solicitada_item_requisicao;if(a>o){d("Erro de Validação",`O item "${i.descricao_material_item_requisicao}" tem uma quantidade atendida (${a}) maior que a solicitada (${o}). Por favor, corrija.`);return}if(a<0){d("Erro de Validação",`O item "${i.descricao_material_item_requisicao}" não pode ter uma quantidade atendida negativa. Por favor, corrija.`);return}}_.value=!0;try{const i={status:"enviado-para-conferencia-separacao",itens:t.value.itens.map(a=>({id_item_requisicao:a.id_item_requisicao,quantidade_atendida_item_requisicao:a.quantidade_atendida_item_requisicao||0}))};await y(t.value.id_requisicao,i),l.title="Separação Efetivada!",l.message="A requisição foi enviada com sucesso para a próxima etapa de conferência.",l.visible=!0}catch(i){console.error("Erro",i),d("Erro","Não foi possível efetivar a separação.")}finally{_.value=!1}}}async function w(){if(!t.value){p.push({name:"Separacao"});return}try{await y(t.value.id_requisicao,{status:"enviado-para-separacao"}),p.push({name:"Separacao"})}catch(i){console.error("Erro ao voltar e reverter status:",i),d("Erro","Ocorreu um erro ao tentar voltar."),p.push({name:"Separacao"})}}return(i,a)=>{var o;return c(),u("div",O,[q($,{title:"Requisição - Separação"}),e("main",T,[e("div",j,[a[7]||(a[7]=e("div",{class:"header-container"},[e("h2",{class:"container-title"},"Requisição - Separação")],-1)),!m.value&&t.value?(c(),u("div",F,[e("div",H,[e("div",null,[a[0]||(a[0]=e("strong",null,"Número:",-1)),v(" "+r(t.value.numero_requisicao),1)]),e("div",null,[a[1]||(a[1]=e("strong",null,"Unidade:",-1)),v(" "+r(t.value.requisitante_requisicao),1)]),e("div",null,[a[2]||(a[2]=e("strong",null,"Prioridade:",-1)),a[3]||(a[3]=v()),e("span",{class:P({"text-yellow-600 font-bold":t.value.prioridade_requisicao})},r(t.value.prioridade_requisicao?"Sim":"Não"),3)]),e("div",null,[a[4]||(a[4]=e("strong",null,"Tipo de Envio:",-1)),v(" "+r(((o=t.value.tipo_envio)==null?void 0:o.descricao_tipo_envio_requisicao)||"Não definido"),1)])]),a[6]||(a[6]=e("h3",{class:"items-title"},"Itens para Separação",-1)),e("div",L,[e("table",null,[a[5]||(a[5]=e("thead",null,[e("tr",null,[e("th",null,"Endereço"),e("th",null,"Material"),e("th",null,"Qtd. Solicitada"),e("th",null,"Qtd. Atendida")])],-1)),e("tbody",null,[(c(!0),u(A,null,I(t.value.itens,s=>(c(),u("tr",{key:s.id_item_requisicao},[e("td",G,r(s.endereco_item_requisicao),1),e("td",J,r(s.descricao_material_item_requisicao),1),e("td",K,r(s.quantidade_solicitada_item_requisicao),1),e("td",W,[B(e("input",{type:"number",class:"input-qty","onUpdate:modelValue":b=>s.quantidade_atendida_item_requisicao=b,max:s.quantidade_solicitada_item_requisicao,min:"0",placeholder:"0",onInput:b=>N(s)},null,40,X),[[D,s.quantidade_atendida_item_requisicao,void 0,{number:!0}]])])]))),128))])])])])):h("",!0),m.value?(c(),u("div",Y,"Carregando detalhes da separação...")):h("",!0),e("footer",Z,[e("button",{onClick:w,class:"button-secondary"},"Voltar"),e("button",{onClick:V,class:"button-primary",disabled:_.value},r(_.value?"Aguarde...":"Efetivar Separação"),9,aa)])])]),q(z,{visible:n.visible,title:n.title,message:n.message,onClose:E},null,8,["visible","title","message"]),q(M,{visible:l.visible,title:l.title,message:l.message},null,8,["visible","title","message"])])}}});const da=U(ea,[["__scopeId","data-v-9eb84a1f"]]);export{da as default};
