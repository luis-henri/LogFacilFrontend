import{d as B,r as f,z as y,A as b,B as U,P as F,c as u,i as k,a,q as g,t as l,n as I,b as C,G as V,F as L,x as M,f as N,Q as T,p as H,E as R,o as d}from"./index-ca90286d.js";import{H as G}from"./Header-d700b98c.js";import{N as O}from"./NotificationPopUp-aebb2319.js";import{A as Q}from"./AcaoConcluidaPopup-497e7117.js";import{_ as j}from"./_plugin-vue_export-helper-c27b6911.js";import"./logosvg-29db6bb5.js";const J={class:"container"},K={class:"grow p-4 sm:p-6 lg:p-8"},W={class:"page-container"},X={key:0,class:"content-wrapper"},Y={class:"details-section"},Z={key:0,class:"no-data-message"},$={key:1,class:"table-container"},ee={class:"responsive-table"},ae=["indeterminate"],se={"data-label":"Volume"},oe={"data-label":"Comprimento"},te={"data-label":"Largura"},ie={"data-label":"Altura"},le={"data-label":"Peso"},ne={"data-label":"Selecionar"},re=["onUpdate:modelValue"],ue={key:1,class:"loading-message"},de={class:"footer-actions"},ce=["disabled"],ve=B({__name:"RemessaDetalhesView",setup(me){const x=T(),_=H(),o=f(null),h=f(!0),v=f(!1),n=f([]),r=y({visible:!1,title:"",message:""});function m(s,e){r.title=s,r.message=e,r.visible=!0}function E(){r.visible=!1}const c=y({visible:!1,title:"",message:""});b(()=>n.value.some(s=>s.checked));function w(s){const t=s.target.checked;n.value.forEach(i=>{i.checked=t})}const p=b({get:()=>n.value.length>0&&n.value.every(s=>s.checked),set:s=>{n.value.forEach(e=>{e.checked=s})}}),z=b(()=>{var e;if(!((e=o.value)!=null&&e.volumes))return!1;const s=o.value.volumes.filter(t=>t.checked).length;return s>0&&s<o.value.volumes.length});function A(){}U(async()=>{var e;const s=x.params.id;try{o.value=await F(s),(e=o.value)!=null&&e.volumes&&(n.value=o.value.volumes.map(t=>({...t,checked:!1})))}catch(t){console.error("Erro ao buscar dados da requisição para remessa:",t),m("Erro","Não foi possível carregar os dados da requisição.")}finally{h.value=!1}});async function S(){if(o.value){if(!p.value){m("Atenção","Você deve selecionar todas as caixas antes de efetivar a conferência.");return}v.value=!0;try{await R(o.value.id_requisicao,{status:"concluida"}),c.title="Requisição Finalizada!",c.message="A requisição foi finalizada com sucesso.",c.visible=!0}catch(s){console.error("Erro ao finalizar requisição:",s),m("Erro","Não foi possível finalizar a requisição. Tente novamente mais tarde.")}finally{v.value=!1}}}async function P(){if(!o.value){_.push({name:"Remessa"});return}try{await R(o.value.id_requisicao,{status:"enviado-para-conferencia-expedicao"}),_.push({name:"Remessa"})}catch(s){console.error("Erro ao voltar e reverter status:",s),m("Erro","Ocorreu um erro ao tentar voltar."),_.push({name:"Remessa"})}}return(s,e)=>{var t;return d(),u("div",J,[k(G,{title:"Requisição - Expedição"}),a("main",K,[a("div",W,[e[12]||(e[12]=a("div",{class:"header-container"},[a("h2",{class:"container-title"},"Conferência - Remessa")],-1)),!h.value&&o.value?(d(),u("div",X,[a("div",Y,[a("div",null,[e[1]||(e[1]=a("strong",null,"Número:",-1)),g(" "+l(o.value.numero_requisicao),1)]),a("div",null,[e[2]||(e[2]=a("strong",null,"Unidade:",-1)),g(" "+l(o.value.requisitante_requisicao),1)]),a("div",null,[e[3]||(e[3]=a("strong",null,"Prioridade:",-1)),e[4]||(e[4]=g()),a("span",{class:I({"text-yellow-600 font-bold":o.value.prioridade_requisicao})},l(o.value.prioridade_requisicao?"Sim":"Não"),3)]),a("div",null,[e[5]||(e[5]=a("strong",null,"Tipo de Envio:",-1)),g(" "+l(((t=o.value.tipo_envio)==null?void 0:t.descricao_tipo_envio_requisicao)||"Não definido"),1)])]),e[11]||(e[11]=a("h3",{class:"items-title"},"Dimensões do Volume",-1)),!o.value.volumes||o.value.volumes.length===0?(d(),u("div",Z," Nenhum volume registado para esta requisição. ")):(d(),u("div",$,[a("table",ee,[a("thead",null,[a("tr",null,[e[6]||(e[6]=a("th",null,"Volume",-1)),e[7]||(e[7]=a("th",null,"Comprimento",-1)),e[8]||(e[8]=a("th",null,"Largura",-1)),e[9]||(e[9]=a("th",null,"Altura",-1)),e[10]||(e[10]=a("th",null,"Peso",-1)),a("th",null,[C(a("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=i=>p.value=i),onChange:w,indeterminate:z.value},null,40,ae),[[V,p.value]])])])]),a("tbody",null,[(d(!0),u(L,null,M(n.value,(i,q)=>(d(),u("tr",{key:q},[a("td",se,l(q+1),1),a("td",oe,l(i.comprimento)+" cm",1),a("td",te,l(i.largura)+" cm",1),a("td",ie,l(i.altura)+" cm",1),a("td",le,l(i.peso)+" kg",1),a("td",ne,[C(a("input",{type:"checkbox","onUpdate:modelValue":D=>i.checked=D,onChange:A},null,40,re),[[V,i.checked]])])]))),128))])])]))])):N("",!0),h.value?(d(),u("div",ue,"Carregando detalhes da remessa...")):N("",!0),a("footer",de,[a("button",{onClick:P,class:"button-secondary"},"Voltar"),a("button",{onClick:S,class:"button-primary",disabled:v.value||!p.value,title:"Marque todas as caixas para poder efetivar"},l(v.value?"Aguarde...":"Efetiva Conferência"),9,ce)])])]),k(O,{visible:r.visible,title:r.title,message:r.message,onClose:E},null,8,["visible","title","message"]),k(Q,{visible:c.visible,title:c.title,message:c.message},null,8,["visible","title","message"])])}}});const ke=j(ve,[["__scopeId","data-v-d5382207"]]);export{ke as default};
